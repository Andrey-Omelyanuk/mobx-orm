import{observable as e,makeObservable as t,autorun as r,computed as n,action as o,runInAction as i,extendObservable as l,intercept as a,observe as u,reaction as c}from"mobx";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(e,t,r,n){var o,i=arguments.length,l=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(l=(i<3?o(l):i>3?o(t,r,l):o(t,r))||l);return i>3&&l&&Object.defineProperty(t,r,l),l}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,r,n){return new(r||(r=Promise))((function(o,i){function l(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,a)}u((n=n.apply(e,t||[])).next())}))}function p(e,t){var r,n,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(o=l.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var y=function(){function n(e,n,o,i,l){var a=this;Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"filters",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"order_by",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"page_size",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"is_ready",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"autoUpdateDisposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t(this),this.autoUpdateDisposer=r((function(){return d(a,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:this.is_ready=!1,n.label=1;case 1:return n.trys.push([1,3,,4]),t=this,[4,e.adapter.load(this.filters,this.order_by,this.page_size,this.page*this.page_size)];case 2:return t.items=n.sent(),[3,4];case 3:return r=n.sent(),this.error=r,[3,4];case 4:return this.is_ready=!0,[2]}}))}))}))}return Object.defineProperty(n.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.autoUpdateDisposer()}}),s([e,f("design:type",Array)],n.prototype,"items",void 0),s([e,f("design:type",Object)],n.prototype,"filters",void 0),s([e,f("design:type",Array)],n.prototype,"order_by",void 0),s([e,f("design:type",Number)],n.prototype,"page",void 0),s([e,f("design:type",Number)],n.prototype,"page_size",void 0),s([e,f("design:type",Boolean)],n.prototype,"is_ready",void 0),s([e,f("design:type",String)],n.prototype,"error",void 0),n}(),v=function(){function e(e){Object.defineProperty(this,"_init_data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disposers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this._init_data=e||{}}return Object.defineProperty(e,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return void 0===e&&(e={}),void 0===t&&(t={}),void 0===r&&(r=0),void 0===n&&(n=50),new y(this,e,t,r,n)}}),Object.defineProperty(e,"clearCache",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t,r,n;try{for(var o=h(this.cache.values()),i=o.next();!i.done;i=o.next()){var l=i.value;try{for(var a=(r=void 0,h(this.ids)),u=a.next();!u.done;u=a.next()){l[u.value]=null}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}}}),Object.defineProperty(e,"__id",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r,n,o="";try{for(var i=h(t),l=i.next();!l.done;l=i.next()){var a=l.value;if(null===e[a]||void 0===e[a])return null;o+=e[a]+" :"}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}}),Object.defineProperty(e.prototype,"__id",{get:function(){return e.__id(this,this.model.ids)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this.constructor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(){return d(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.model.adapter.save(this)]}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(){return d(this,void 0,void 0,(function(){var e,t,r,n;return p(this,(function(o){switch(o.label){case 0:return[4,this.model.adapter.delete(this)];case 1:o.sent();try{for(e=h(this.model.ids),t=e.next();!t.done;t=e.next())this[t.value]=null}catch(e){r={error:e}}finally{try{t&&!t.done&&(n=e.return)&&n.call(e)}finally{if(r)throw r.error}}return[2]}}))}))}}),Object.defineProperty(e.prototype,"inject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(null===this.__id)throw new Error("Object should have id!");if(this.model.cache.has(this.__id))throw new Error('Object with id "'+this.__id+'" already exist in the cache of model: "'+this.model.name+'")');this.model.cache.set(this.__id,this)}}),Object.defineProperty(e.prototype,"eject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(null!==this.__id){if(!this.model.cache.has(this.__id))throw new Error('Object with id "'+this.__id+'" not exist in the cache of model: '+this.model.name+'")');this.model.cache.delete(this.__id)}}}),s([n,f("design:type",String),f("design:paramtypes",[])],e.prototype,"__id",null),s([o,f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],e.prototype,"inject",null),s([o,f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],e.prototype,"eject",null),e}();function b(r){var n=r;n.cache=e(new Map);var o=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=function(){return n.apply(this,e)};o.__proto__=n,o.prototype=n.prototype;var l=new o;for(var a in t(l),l.model.fields)void 0===l._init_data[a]&&void 0!==l[a]&&(l._init_data[a]=l[a]);for(var a in l.model.fields)l.model.fields[a].decorator(l,a);return i((function(){for(var e in l._init_data)l[e]=l._init_data[e]})),l};return o.__proto__=n,o.prototype=n.prototype,o}var _={},m=function(){function e(e,t){Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"store_name",{enumerable:!0,configurable:!0,writable:!0,value:t}),_[t]={}}return Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){var t,r,n,o,i,l,a,u,c,s,f,d;return p(this,(function(p){if(null===e.__id){t=[0];try{for(r=h(Object.keys(_[this.store_name])),n=r.next();!n.done;n=r.next())o=n.value,t.push(parseInt(o))}catch(e){c={error:e}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(c)throw c.error}}i=Math.max.apply(null,t);try{for(l=h(e.model.ids),a=l.next();!a.done;a=l.next())u=a.value,e[u]=i+1}catch(e){f={error:e}}finally{try{a&&!a.done&&(d=l.return)&&d.call(l)}finally{if(f)throw f.error}}_[this.store_name][e.__id]=e}else _[this.store_name][e.__id]=e;return[2,e]}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){return p(this,(function(t){return delete _[this.store_name][e.__id],[2]}))}))}}),Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){throw"Not implemented"}}),e}();function g(e){return function(t){var r=new m(t,e);t.__proto__.adapter=r}}var w=function(){function e(e,t,r){Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"http",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"api",{enumerable:!0,configurable:!0,writable:!0,value:r})}return Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:for(r in t={},e.model.fields)null!==e[r]&&(t[r]=e[r]);return null!==e.__id?[3,2]:[4,this.http.post(this.api+"/",t)];case 1:for(r in t=n.sent(),e.model.fields)e[r]=t[r];return[3,4];case 2:return[4,this.http.put(this.api+"/"+e.__id+"/",t)];case 3:for(r in t=n.sent(),e.model.fields)e.model.ids.includes(r)||(e[r]=t[r]);n.label=4;case 4:return[2,e]}}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.http.delete(this.api+"/"+e.__id+"/")]}))}))}}),Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return d(this,void 0,void 0,(function(){var e,t,r,n,o,i,l;return p(this,(function(a){switch(a.label){case 0:return"",[4,this.http.get(this.api+"/?")];case 1:e=a.sent(),t=[];try{for(r=h(e),n=r.next();!n.done;n=r.next())o=n.value,t.push(new this.cls(o))}catch(e){i={error:e}}finally{try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(i)throw i.error}}return[2,t]}}))}))}}),e}();function j(e,t){return function(r){var n=new w(r,e,t);r.__proto__.adapter=n}}function O(e,t){var r;l(e,((r={})[t]=null,r)),a(e,t,(function(r){if(null!==r.newValue&&null!==e[t])throw new Error("You cannot change id field: "+t+". "+e[t]+" to "+r.newValue);if(null!==e[t]&&null===r.newValue)try{e.eject()}catch(t){var n='Object with id "'+e.__id+'" not exist in the model cache: '+e.model.name+'")';if(t.name!==n)throw t}return r})),u(e,t,(function(t){null!==e.__id&&e.inject()}))}function x(e,t){var r=e.constructor;void 0===r.fields&&(r.fields={}),void 0===r.ids&&(r.ids=[]),r.fields[t]={decorator:O},r.ids.push(t)}function P(e,t){var r;l(e,((r={})[t]=null,r))}function V(e,t){var r=e.constructor;void 0===r.fields&&(r.fields={}),r.fields[t]={decorator:P}}function E(e,t){var r,n=!1,o=e.model.fields[t].settings,i=o.foreign_model,s=o.foreign_ids_names;l(e,((r={})[t]=null,r)),c((function(){var t=i.__id(e,s);return t?i.cache.get(t):null}),(function(r,n,o){e[t]=r||null})),a(e,t,(function(e){if(null!==e.newValue&&(!e.newValue.constructor||e.newValue.constructor!=i.__proto__))throw new Error('You can set only instance of "'+i.__proto__.name+'" or null');return e})),u(e,t,(function(t){var r,i,l=t.newValue,a=t.oldValue;if(l!==a&&!n){n=!0;try{if(null===t.newValue)try{for(var u=h(s),c=u.next();!c.done;c=u.next()){var f=c.value;e[f]=null}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}else for(var d=t.newValue.model.ids,p=0;p<s.length;p++)e[s[p]]!=t.newValue[d[p]]&&(e[s[p]]=t.newValue[d[p]]);n=!1}catch(r){if(null===t.oldValue)for(p=0;p<s.length;p++)e[s[p]]=null;else for(d=t.oldValue.model.ids,p=0;p<s.length;p++)e[s[p]]=t.oldValue[d[p]];throw n=!1,r}o.one&&(a&&(a[o.one]=null),l&&(l[o.one]=e))}}))}function k(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(r,n){var o=r.constructor;void 0===o.fields&&(o.fields={}),o.fields[n]={decorator:E,settings:{foreign_model:e,foreign_ids_names:t.length?t:[n+"_id"]}}}}function S(e,t){var r,n=!1,o=e.model.fields[t].settings.remote_model,i=e.model.fields[t].settings.remote_foreign_ids_names;l(e,((r={})[t]=null,r)),a(e,t,(function(e){if(null!==e.newValue&&(!e.newValue.constructor||e.newValue.constructor!==o.__proto__))throw new Error('You can set only instance of "'+o.__proto__.name+'" or null');return e})),u(e,t,(function(t){var r,o,l=t.oldValue,a=t.newValue;if(a!==l&&!n){n=!0;try{if(l)try{for(var u=h(i),c=u.next();!c.done;c=u.next()){l[c.value]=null}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}if(a)for(var s=e.model.ids,f=0;f<i.length;f++)a[i[f]]!=e[s[f]]&&(a[i[f]]=e[s[f]]);n=!1}catch(e){}}}))}function R(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(n,o){var l=n.prototype.constructor;void 0===l.fields&&(l.fields={}),t=t.length?t:[l.name.toLowerCase()+"_id"],l.fields[o]={decorator:S,settings:{remote_model:e,remote_foreign_ids_names:t}},u(e.cache,(function(e){var n;switch(e.type){case"add":(n=e.newValue).disposers.set("one "+o,r((function(){var e=l.cache.get(l.__id(n,t));e&&i((function(){e[o]=n}))})));break;case"delete":(n=e.oldValue).disposers.get("one "+o)&&(n.disposers.get("one "+o)(),n.disposers.delete("one "+o));var a=l.cache.get(l.__id(n,t));a&&i((function(){a[o]=null}))}}))}}function z(e,t){var r;e.model.fields[t].settings.remote_model;var n=e.model.fields[t].settings.remote_foreign_ids_names;l(e,((r={})[t]=[],r)),a(e[t],(function(e){return e})),u(e[t],(function(t){var r,o,i,l,a,u;if("splice"===t.type){var c=t.removed,s=t.added;!0;try{try{for(var f=h(c),d=f.next();!d.done;d=f.next()){var p=d.value;try{for(var y=(i=void 0,h(n)),v=y.next();!v.done;v=y.next()){p[v.value]=null}}catch(e){i={error:e}}finally{try{v&&!v.done&&(l=y.return)&&l.call(y)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}var b=e.model.ids;try{for(var _=h(s),m=_.next();!m.done;m=_.next())for(var g=m.value,w=0;w<n.length;w++)g[n[w]]!=e[b[w]]&&(g[n[w]]=e[b[w]])}catch(e){a={error:e}}finally{try{m&&!m.done&&(u=_.return)&&u.call(_)}finally{if(a)throw a.error}}!1}catch(e){}}}))}function D(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(n,o){var l=n.prototype.constructor;void 0===l.fields&&(l.fields={}),t=t.length?t:[l.name.toLowerCase()+"_id"],l.fields[o]={decorator:z,settings:{remote_model:e,remote_foreign_ids_names:t}},u(e.cache,(function(e){var n;switch(e.type){case"add":(n=e.newValue).disposers.set("many "+o,r((function(){var e=l.cache.get(l.__id(n,t));e&&(-1==e[o].indexOf(n)&&i((function(){e[o].push(n)})))})));break;case"delete":(n=e.oldValue).disposers.get("many "+o)&&(n.disposers.get("many "+o)(),n.disposers.delete("many "+o));var a=l.cache.get(l.__id(n,t));if(a){var u=a[o].indexOf(n);u>-1&&i((function(){a[o].splice(u,1)}))}}}))}}export{m as LocalAdapter,v as Model,y as Query,w as RestAdapter,V as field,k as foreign,x as id,g as local,D as many,b as model,R as one,j as rest};
//# sourceMappingURL=mobx-orm.es2015.js.map
