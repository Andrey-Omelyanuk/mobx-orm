import{observable as e,makeObservable as t,autorun as r,observe as n,reaction as i,runInAction as o,computed as l,action as a,extendObservable as u,intercept as c}from"mobx";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(e,t,r,n){var i,o=arguments.length,l=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(l=(o<3?i(l):o>3?i(t,r,l):i(t,r))||l);return o>3&&l&&Object.defineProperty(t,r,l),l}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,r,n){return new(r||(r=Promise))((function(i,o){function l(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,a)}u((n=n.apply(e,t||[])).next())}))}function p(e,t){var r,n,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var y=function(){function l(e,l,a,u,c){var s=this;Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"filters",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"order_by",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"page_size",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"is_ready",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"disposers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"disposer_objects",{enumerable:!0,configurable:!0,writable:!0,value:{}}),l&&(this.filters=l),a&&(this.order_by=a),u&&(this.page=u),c&&(this.page_size=c),t(this),this.disposers.push(r((function(){return d(s,void 0,void 0,(function(){var t,r,n=this;return p(this,(function(i){switch(i.label){case 0:o((function(){return n.is_ready=!1})),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.adapter.load(this.filters,this.order_by,this.page_size,this.page*this.page_size)];case 2:return t=i.sent(),o((function(){return n.items=t})),[3,4];case 3:return r=i.sent(),o((function(){return n.error=r})),[3,4];case 4:return o((function(){return n.is_ready=!0})),[2]}}))}))}))),this.disposers.push(n(e.cache,(function(e){if("add"==e.type){var t=e.name,r=e.newValue;v(r,s.filters)&&s.items.push(r),s.disposer_objects[t]=i((function(){return v(r,s.filters)}),(function(e){var t=s.items.indexOf(r);e&&-1==t&&s.items.push(r),e||-1==t||s.items.splice(t,1)}))}if("delete"==e.type){t=e.name;var n=e.oldValue;s.disposer_objects[t](),delete s.disposer_objects[t];var o=s.items.indexOf(n);-1!=o&&s.items.splice(o,1)}})))}return Object.defineProperty(l.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t;try{for(var r=h(this.disposers),n=r.next();!n.done;n=r.next()){(0,n.value)()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}}),s([e,f("design:type",Array)],l.prototype,"items",void 0),s([e,f("design:type",Object)],l.prototype,"filters",void 0),s([e,f("design:type",Array)],l.prototype,"order_by",void 0),s([e,f("design:type",Number)],l.prototype,"page",void 0),s([e,f("design:type",Number)],l.prototype,"page_size",void 0),s([e,f("design:type",Boolean)],l.prototype,"is_ready",void 0),s([e,f("design:type",String)],l.prototype,"error",void 0),l}();function v(e,t){if(Object.keys(t).length){for(var r in t)if(e[r]!=t[r])return!1;return!0}return!0}var b=function(){function e(e){Object.defineProperty(this,"_init_data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"disposers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this._init_data=e||{}}return Object.defineProperty(e,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return void 0===e&&(e={}),void 0===t&&(t={}),void 0===r&&(r=0),void 0===n&&(n=50),new y(this,e,t,r,n)}}),Object.defineProperty(e,"clearCache",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t,r,n;try{for(var i=h(this.cache.values()),o=i.next();!o.done;o=i.next()){var l=o.value;try{for(var a=(r=void 0,h(this.ids)),u=a.next();!u.done;u=a.next()){l[u.value]=null}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}}),Object.defineProperty(e,"__id",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r,n,i="";try{for(var o=h(t),l=o.next();!l.done;l=o.next()){var a=l.value;if(null===e[a]||void 0===e[a])return null;i+=e[a]+" :"}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}}),Object.defineProperty(e.prototype,"__id",{get:function(){return e.__id(this,this.model.ids)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"model",{get:function(){return this.constructor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(){return d(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.model.adapter.save(this)]}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(){return d(this,void 0,void 0,(function(){var e,t,r,n;return p(this,(function(i){switch(i.label){case 0:return[4,this.model.adapter.delete(this)];case 1:i.sent();try{for(e=h(this.model.ids),t=e.next();!t.done;t=e.next())this[t.value]=null}catch(e){r={error:e}}finally{try{t&&!t.done&&(n=e.return)&&n.call(e)}finally{if(r)throw r.error}}return[2]}}))}))}}),Object.defineProperty(e.prototype,"inject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(null===this.__id)throw new Error("Object should have id!");if(this.model.cache.has(this.__id))throw new Error('Object with id "'+this.__id+'" already exist in the cache of model: "'+this.model.name+'")');this.model.cache.set(this.__id,this)}}),Object.defineProperty(e.prototype,"eject",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(null!==this.__id){if(!this.model.cache.has(this.__id))throw new Error('Object with id "'+this.__id+'" not exist in the cache of model: '+this.model.name+'")');this.model.cache.delete(this.__id)}}}),s([l,f("design:type",String),f("design:paramtypes",[])],e.prototype,"__id",null),s([a,f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],e.prototype,"inject",null),s([a,f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],e.prototype,"eject",null),e}();function _(r){var n=r;n.cache=e(new Map);var i=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=function(){return n.apply(this,e)};i.__proto__=n,i.prototype=n.prototype;var l=new i;for(var a in t(l),l.model.fields)void 0===l._init_data[a]&&void 0!==l[a]&&(l._init_data[a]=l[a]);for(var a in l.model.fields)l.model.fields[a].decorator(l,a);return o((function(){var e,t,r=[];for(var n in l._init_data)l.model.ids&&l.model.ids.includes(n)?r.push(n):l[n]=l._init_data[n];try{for(var i=h(r),o=i.next();!o.done;o=i.next()){n=o.value;l[n]=l._init_data[n]}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}})),l};return i.__proto__=n,i.prototype=n.prototype,i}var m={},g=function(){function e(e,t){Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"store_name",{enumerable:!0,configurable:!0,writable:!0,value:t}),m[t]={}}return Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){var t,r,n,i,o,l,a,u,c,s,f,d;return p(this,(function(p){if(null===e.__id){t=[0];try{for(r=h(Object.keys(m[this.store_name])),n=r.next();!n.done;n=r.next())i=n.value,t.push(parseInt(i))}catch(e){c={error:e}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(c)throw c.error}}o=Math.max.apply(null,t);try{for(l=h(e.model.ids),a=l.next();!a.done;a=l.next())u=a.value,e[u]=o+1}catch(e){f={error:e}}finally{try{a&&!a.done&&(d=l.return)&&d.call(l)}finally{if(f)throw f.error}}m[this.store_name][e.__id]=e}else m[this.store_name][e.__id]=e;return[2,e]}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){return p(this,(function(t){return delete m[this.store_name][e.__id],[2]}))}))}}),Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){throw"Not implemented"}}),e}();function w(e){return function(t){var r=new g(t,e);t.__proto__.adapter=r}}var j=function(){function e(e,t,r){Object.defineProperty(this,"cls",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"http",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"api",{enumerable:!0,configurable:!0,writable:!0,value:r})}return Object.defineProperty(e.prototype,"save",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){var t,r;return p(this,(function(n){switch(n.label){case 0:for(r in t={},e.model.fields)null!==e[r]&&(t[r]=e[r]);return null!==e.__id?[3,2]:[4,this.http.post(this.api+"/",t)];case 1:for(r in t=n.sent(),e.model.fields)e[r]=t[r];return[3,4];case 2:return[4,this.http.put(this.api+"/"+e.__id+"/",t)];case 3:for(r in t=n.sent(),e.model.fields)e.model.ids.includes(r)||(e[r]=t[r]);n.label=4;case 4:return[2,e]}}))}))}}),Object.defineProperty(e.prototype,"delete",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return d(this,void 0,void 0,(function(){return p(this,(function(t){return[2,this.http.delete(this.api+"/"+e.__id+"/")]}))}))}}),Object.defineProperty(e.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return d(this,void 0,void 0,(function(){var e,t,r,n,i,o,l;return p(this,(function(a){switch(a.label){case 0:return"",[4,this.http.get(this.api+"/?")];case 1:e=a.sent(),t=[];try{for(r=h(e),n=r.next();!n.done;n=r.next())i=n.value,t.push(new this.cls(i))}catch(e){o={error:e}}finally{try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(o)throw o.error}}return[2,t]}}))}))}}),e}();function O(e,t){return function(r){var n=new j(r,e,t);r.__proto__.adapter=n}}function x(e,t){var r;u(e,((r={})[t]=null,r)),c(e,t,(function(r){if(null!==r.newValue&&null!==e[t])throw new Error("You cannot change id field: "+t+". "+e[t]+" to "+r.newValue);if(null!==e[t]&&null===r.newValue)try{e.eject()}catch(t){var n='Object with id "'+e.__id+'" not exist in the model cache: '+e.model.name+'")';if(t.name!==n)throw t}return r})),n(e,t,(function(t){null!==e.__id&&e.inject()}))}function P(e,t){var r=e.constructor;void 0===r.fields&&(r.fields={}),void 0===r.ids&&(r.ids=[]),r.fields[t]={decorator:x},r.ids.push(t)}function V(e,t){var r;u(e,((r={})[t]=null,r))}function k(e,t){var r=e.constructor;void 0===r.fields&&(r.fields={}),r.fields[t]={decorator:V}}function E(e,t){var r,o=!1,l=e.model.fields[t].settings,a=l.foreign_model,s=l.foreign_ids_names;u(e,((r={})[t]=null,r)),i((function(){var t=a.__id(e,s);return t?a.cache.get(t):null}),(function(r,n,i){e[t]=r||null})),c(e,t,(function(e){if(null!==e.newValue&&(!e.newValue.constructor||e.newValue.constructor!=a.__proto__))throw new Error('You can set only instance of "'+a.__proto__.name+'" or null');return e})),n(e,t,(function(t){var r,n,i=t.newValue,a=t.oldValue;if(i!==a&&!o){o=!0;try{if(null===t.newValue)try{for(var u=h(s),c=u.next();!c.done;c=u.next()){var f=c.value;e[f]=null}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}else for(var d=t.newValue.model.ids,p=0;p<s.length;p++)e[s[p]]!=t.newValue[d[p]]&&(e[s[p]]=t.newValue[d[p]]);o=!1}catch(r){if(null===t.oldValue)for(p=0;p<s.length;p++)e[s[p]]=null;else for(d=t.oldValue.model.ids,p=0;p<s.length;p++)e[s[p]]=t.oldValue[d[p]];throw o=!1,r}l.one&&(a&&(a[l.one]=null),i&&(i[l.one]=e))}}))}function S(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(r,n){var i=r.constructor;void 0===i.fields&&(i.fields={}),i.fields[n]={decorator:E,settings:{foreign_model:e,foreign_ids_names:t.length?t:[n+"_id"]}}}}function R(e,t){var r,i=!1,o=e.model.fields[t].settings.remote_model,l=e.model.fields[t].settings.remote_foreign_ids_names;u(e,((r={})[t]=null,r)),c(e,t,(function(e){if(null!==e.newValue&&(!e.newValue.constructor||e.newValue.constructor!==o.__proto__))throw new Error('You can set only instance of "'+o.__proto__.name+'" or null');return e})),n(e,t,(function(t){var r,n,o=t.oldValue,a=t.newValue;if(a!==o&&!i){i=!0;try{if(o)try{for(var u=h(l),c=u.next();!c.done;c=u.next()){o[c.value]=null}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}if(a)for(var s=e.model.ids,f=0;f<l.length;f++)a[l[f]]!=e[s[f]]&&(a[l[f]]=e[s[f]]);i=!1}catch(e){}}}))}function z(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return function(i,l){var a=i.prototype.constructor;void 0===a.fields&&(a.fields={}),t=t.length?t:[a.name.toLowerCase()+"_id"],a.fields[l]={decorator:R,settings:{remote_model:e,remote_foreign_ids_names:t}},n(e.cache,(function(e){var n;switch(e.type){case"add":(n=e.newValue).disposers.set("one "+l,r((function(){var e=a.cache.get(a.__id(n,t));e&&o((function(){e[l]=n}))})));break;case"delete":(n=e.oldValue).disposers.get("one "+l)&&(n.disposers.get("one "+l)(),n.disposers.delete("one "+l));var i=a.cache.get(a.__id(n,t));i&&o((function(){i[l]=null}))}}))}}function C(e,t){var r;e.model.fields[t].settings.remote_model;var i=e.model.fields[t].settings.remote_foreign_ids_names;u(e,((r={})[t]=[],r)),c(e[t],(function(e){return e})),n(e[t],(function(t){var r,n,o,l,a,u;if("splice"===t.type){var c=t.removed,s=t.added;!0;try{try{for(var f=h(c),d=f.next();!d.done;d=f.next()){var p=d.value;try{for(var y=(o=void 0,h(i)),v=y.next();!v.done;v=y.next()){p[v.value]=null}}catch(e){o={error:e}}finally{try{v&&!v.done&&(l=y.return)&&l.call(y)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}var b=e.model.ids;try{for(var _=h(s),m=_.next();!m.done;m=_.next())for(var g=m.value,w=0;w<i.length;w++)g[i[w]]!=e[b[w]]&&(g[i[w]]=e[b[w]])}catch(e){a={error:e}}finally{try{m&&!m.done&&(u=_.return)&&u.call(_)}finally{if(a)throw a.error}}!1}catch(e){}}}))}function M(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return function(i,l){var a=i.prototype.constructor;void 0===a.fields&&(a.fields={}),t=t.length?t:[a.name.toLowerCase()+"_id"],a.fields[l]={decorator:C,settings:{remote_model:e,remote_foreign_ids_names:t}},n(e.cache,(function(e){var n;switch(e.type){case"add":(n=e.newValue).disposers.set("many "+l,r((function(){var e=a.cache.get(a.__id(n,t));e&&(-1==e[l].indexOf(n)&&o((function(){e[l].push(n)})))})));break;case"delete":(n=e.oldValue).disposers.get("many "+l)&&(n.disposers.get("many "+l)(),n.disposers.delete("many "+l));var i=a.cache.get(a.__id(n,t));if(i){var u=i[l].indexOf(n);u>-1&&o((function(){i[l].splice(u,1)}))}}}))}}export{g as LocalAdapter,b as Model,y as Query,j as RestAdapter,k as field,S as foreign,P as id,w as local,M as many,_ as model,z as one,O as rest};
//# sourceMappingURL=mobx-orm.es2015.js.map
